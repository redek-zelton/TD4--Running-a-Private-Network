# TD4--Running-a-Private-Network

## Instruction


## SSH Setup
Permet de donner accès à certaines personnes dans le VM

### Putty Configuration:
```
1) Put host name or IP
2) (Connection type) SSH
3) saved Sessions -> load -> save
4) connection -> SSH -> Auth -> put private_key was generated by Puttygen
5) save
6) Open Session
```
![Putty1](https://github.com/redek-zelton/TD3---Running-a-GETH-node/blob/main/image/Putty1.JPG)
![Putty2](https://github.com/redek-zelton/TD3---Running-a-GETH-node/blob/main/image/Putty2.JPG)

### On the Virtual Machine:
```bash
$ sudo nano /etc/ssh/sshd_config
#We paste our ssh-rsa pubkey in the file
#We can then Restart the SSH daemon, then exit and log in again.
$ sudo systemctl restart sshd
$ exit
```



## UFW Config
Permet d'ouvrir les ports, autorisé les trafics: SSH(22) ; 8545(HTTP based JSON RPC API) 8546(WebSocket based JSON RPC API) ; 30300(The P2P node1) ; 30301(The P2P node2) ; 30302(The P2P node3) ; 30303(The P2P node4 admin by default) ; 30304(The P2P node5) ; 9001(Tessera) ; 9003 ; 9081(ThirdParty)

```bash
#Installation
$sudo apt install ufw
$sudo ufw default deny incoming
$sudo ufw default allow outgoing
#Mode admin
$sudo su
#Acceptation des ports
$ufw allow #port comment #LeNom
#Reboot
$ufw enable
$systemctl enable ufw
#Checker les ports
$ufw status
#Quitter
$exit
```
![UFW](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/UFW.JPG)



## Installing Dependencies
Go can be installed, but it is optionnal for us.
Java is needed for use Tessera.

### Install Go
[Install Go](https://github.com/golang/go/wiki/Ubuntu?fbclid=IwAR2QP1jmv8EnGd_JLlDqUEZulwRWsmf9y-tyN4j49ECUEYiM7jj8QF9IyTw)
```bash
$sudo add-apt-repository ppa:longsleep/golang-backports
$sudo apt update
$sudo apt install golang-go
$go version
>go version go1.17.1 linux/amd64
```

### Install Java for Tessera
```bash
$sudo apt install default-jre
$java -version
>openjdk version "11.0.11" 2021-04-20
OpenJDK Runtime Environment (build 11.0.11+9-Ubuntu-0ubuntu2.18.04)
OpenJDK 64-Bit Server VM (build 11.0.11+9-Ubuntu-0ubuntu2.18.04, mixed mode, sharing)
```



## Installing Quorum
We need to install Quorum: [Quorum Install](https://docs.goquorum.consensys.net/en/latest/GetStarted/Install/)
Three ways to install, we chose the release binaries.
- go to this:[link](https://github.com/ConsenSys/quorum/releases)
- take latest version: [geth_v21.7.1_linux_amd64.tar.gz](https://artifacts.consensys.net/public/go-quorum/raw/versions/v21.7.1/geth_v21.7.1_linux_amd64.tar.gz)
- go to the Virtual Marchine

```bash
# Folder for the installation
$mkdir QuorumFolder
$cd QuorumFolder
# Download binary zip file
$wget https://artifacts.consensys.net/public/go-quorum/raw/versions/v21.7.1_linux_amd64.tar.gz
# Extract binary zip
$tar -xzvf geth_v21.7.1_linux_amd64.tar.gz
# Copy to the local bin
$sudo cp geth /usr/local/bin
# Check version
$geth version
```
![IQuorum](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/IQuorum.JPG)



## Connect Geth to our group's private network
Can help: [link](https://docs.goquorum.consensys.net/en/stable/Tutorials/Private-Network/Create-IBFT-Network/)
```bash
# Create a folder
$mkdir Network
$cd Network
# Create the `genesis.json`
$vi genesis.json #put inside
# initialisation the genesis with the creation of new folder "data"
$geth --datadir data init genesis.json
# put the `static-node.json` in data
$cd data
$vi static-node.json
# launch the private node in Network folder
$PRIVATE_CONFIG=ignore geth --datadir data --http --http.addr "127.0.0.1" --http.port 8545 --http.api eth,net,web3,personal,shh,txpool,quorum,istanbul
# Or add --allow-insecure-unlock to unlock address
$PRIVATE_CONFIG=ignore geth --datadir data --allow-insecure-unlock --http --http.addr "127.0.0.1" --http.port 8545 --http.api eth,net,web3,personal,shh,txpool,quorum,istanbul
```
![LQuorum](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/LQuorum.JPG)
```bash
#Other Virtual Machine
$geth attach Network/data/geth.ipc
# Check
>net.peerCount
>istanbul.nodeAddress
>istanbul.getValidators()
```
![CQuorum](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/CQuorum.JPG)



## Deploy a contract
We need to create an accounts for deploying a Smart Contract in this Network
```bash
# In Network Console
#Create account
>personal.newAccount()
passphrase: #PWD
Reapeat passphrase: #PWD
"0xa4d16a7da64d2ae330c2f973e9fe097ede05eceb" #Example
>personal.unlockAccount("#account")
```
![AQuorum](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/AQuorum.JPG)

Now, We can create a Smart Contract With Truffle and Deploy it



## Installing Tessera
We can follow this: [Tessera Install Tuto](https://docs.tessera.consensys.net/en/stable/HowTo/Get-started/Distribution/)
- Go to [Tessera Install](https://github.com/ConsenSys/tessera/releases)
- Take latest version : [Tessera-21.7.2](https://oss.sonatype.org/service/local/repositories/releases/content/net/consensys/quorum/tessera/tessera-dist/21.7.2/tessera-dist-21.7.2.tar)
- Go to the Virtual Marchine

```bash
#Create Folder
$mkdir Tessera
$cd Tessera
# Download Tessera Binary file
$wget https://oss.sonatype.org/service/local/repositories/releases/content/net/consensys/quorum/tessera/tessera-dist/21.7.2/tessera-dist-21.7.2.tar
# Extract folder
tar xvf tessera-dist-21.7.2.tar
# Can check version with:
$./tessera version #in bin folder
$./tessera-21.7.2/bin/tessera help #in Tessera folder
```
![ITessera](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/ITessera.JPG)



## Configure Tessera
We can follow this: [Tessera Configuration](https://docs.tessera.consensys.net/en/latest/HowTo/Get-started/Start-Tessera/)

```bash
# Generate Keys
$~/Tessera/tessera-21.7.2/bin/tessera -keygen -filename myKey
# Create a `config.json` in Tessera folder
$vi config.json # put teacher node in 'peer'
# Start Tessera node
$tessera-21.7.2/bin/tessera -configfile config.json
# Check Tessera is running
$curl http://localhost:9081/upcheck
>I'm up!
```
![KTessera](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/KTessera.JPG)
![CTessera](https://github.com/redek-zelton/TD4--Running-a-Private-Network/blob/main/image/CTessera.JPG)



## Create a private Smart Contract with .........



## Conclusion TD



## Documentation
- [GoQuorum](https://docs.goquorum.consensys.net)
